# System (Default)
import sys
#   Add access if it is not in the system path.
if '../' + 'src' not in sys.path:
    sys.path.append('../..')
# OS (Operating system interfaces)
import os
# OpenCV (Computer Vision) [pip3 install opencv-python]
import cv2
# Custom Library:
#   ../Lib/Utilities/Image_Processing
import Lib.Utilities.Image_Processing
#   ../Lib/Utilities/File_IO
import Lib.Utilities.File_IO as File_IO

"""
Description:
    Initialization of constants.
"""
# The ID of the object to be processed.
CONST_OBJECT_ID = 0
# Available objects.
#   ID{0} = 'T_Joint'
#   ID{1} = 'Metal_Blank'
CONST_OBJECT_NAME = ['T_Joint', 'Metal_Blank']
# The color of the bounding box of the object.
CONST_OBJECT_BB_COLOR = [(255, 165, 0), (0, 165, 255)]
# Initial iteration of the scanning process.
CONST_SCAN_ITERATION = 25
# The name of the partition of the dataset.
#   Note:
#      Possible names to choose from: ['train', 'valid', 'test']
CONST_PARTITION_DATASET = 'test'
# The identification number of the dataset type.
CONST_DATASET_TYPE = 0
# Name of the dataset.
CONST_DATASET_NAME = f'Dataset_Type_{CONST_DATASET_TYPE}'

def main():
    """
    Description:
        A program to evaluate synthetic data (image with corresponding label) generated from Blender 
        or mixed data (synthetic data with real camera data).
    """

    # Locate the path to the project folder.
    project_folder = os.getcwd().split('Object_Detection_Synthetic_Data')[0] + 'Object_Detection_Synthetic_Data'

    # Express the name of the image. 
    if CONST_PARTITION_DATASET == 'test':
        image_name = f'Image_{CONST_SCAN_ITERATION:05}'
    else:
        image_name = f'Object_ID_{CONST_OBJECT_ID}_{CONST_SCAN_ITERATION:05}'

    # Load a raw image from a file.
    image_data = cv2.imread(f'{project_folder}/Data/{CONST_DATASET_NAME}/images/{CONST_PARTITION_DATASET}/{image_name}.png')
    # Load a label (annotation) from a file.
    label_data = File_IO.Load(f'{project_folder}/Data/{CONST_DATASET_NAME}/labels/{CONST_PARTITION_DATASET}/{image_name}', 'txt', ' ')

    for i, label_data_i in enumerate(label_data):
        # Create a bounding box from the label data.
        Bounding_Box_Properties = {'Name': f'{CONST_OBJECT_NAME[int(label_data_i[0])]}_{i}', 'Precision': None, 
                                   'Data': {'x_c': label_data_i[1], 'y_c': label_data_i[2], 'width': label_data_i[3], 'height': label_data_i[4]}}

        # Draw the bounding box of the object with additional dependencies (name, precision, etc.) in 
        # the raw image.
        image_data = Lib.Utilities.Image_Processing.Draw_Bounding_Box(image_data, Bounding_Box_Properties, 'YOLO', CONST_OBJECT_BB_COLOR[int(label_data_i[0])], 
                                                                      True, False)

    # Displays the image in the window.
    cv2.imshow('Synthetic Data Generated by Blender', image_data)
    cv2.waitKey(0)
    cv2.destroyAllWindows()

if __name__ == '__main__':
    sys.exit(main())